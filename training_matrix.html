<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training Matrix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f2f5;
        }
        .header {
            background-color: #fff;
            padding: 10px 20px;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header .logo {
            display: flex;
            align-items: center;
        }
        .header .logo img {
            height: 40px;
        }
        .header .title {
            margin-left: 10px;
        }
        .header .user-profile img {
            height: 40px;
            border-radius: 50%;
        }
        .navbar {
            background-color: #fff;
            border-bottom: 1px solid #ddd;
        }
        .sidebar {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
        }
        .main-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
        }
        .footer {
            text-align: center;
            padding: 20px;
            color: #888;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <div class="logo">
                <img src="https://via.placeholder.com/100x40.png?text=TAIYO" alt="TAIYO">
                <div class="title">
                    <h5>Document Flow</h5>
                    <p>/ Search Training</p>
                </div>
            </div>
            <div class="user-profile">
                <img src="https://via.placeholder.com/40x40.png" alt="User">
            </div>
        </div>



        <div class="container-fluid mt-4">
            <div class="row">
                <div class="col-md-4">
                    <div class="sidebar">
                        <h5>Training KPI Employee</h5>
                        <form @submit.prevent="applyFilters">
                            <div class="mb-3">
                                <label for="filterCourse" class="form-label">Course</label>
                                <select class="form-select" id="filterCourse" v-model="filterCourse">
                                    <option value="">All Courses</option>
                                    <option v-for="course in availableCourses" :value="course.name">{{ course.name }}</option>
                                </select>
                            </div>
                            <div class="mb-3" v-if="trainingRounds.length > 1">
                                <label for="filterRound" class="form-label">Training Round</label>
                                <select class="form-select" id="filterRound" v-model="filterRound">
                                    <option value="">All Rounds</option>
                                    <option v-for="round in trainingRounds" :value="round">{{ round }}</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="filterEmployeeId" class="form-label">Employee Id</label>
                                <input type="text" class="form-control" id="filterEmployeeId" v-model="filterEmployeeId">
                            </div>

                            <button type="submit" class="btn btn-primary">Search</button>
                            <button type="button" class="btn btn-secondary" @click="resetFilters">Reset</button>
                        </form>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="main-content">
                        <h5>Training Matrix</h5>
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th @click="sortBy('empcardid')">Emp CardId <span v-if="sortKey === 'empcardid'">{{ sortOrder === 'asc' ? '▲' : '▼' }}</span></th>
                                    <th @click="sortBy('name')">Employee <span v-if="sortKey === 'name'">{{ sortOrder === 'asc' ? '▲' : '▼' }}</span></th>
                                    <th @click="sortBy('jobtitle')">Job Title <span v-if="sortKey === 'jobtitle'">{{ sortOrder === 'asc' ? '▲' : '▼' }}</span></th>
                                    <th @click="sortBy('departmentname')">Department <span v-if="sortKey === 'departmentname'">{{ sortOrder === 'asc' ? '▲' : '▼' }}</span></th>
                                    <th @click="sortBy('courseStatus')">{{ filterCourse || 'Course Name' }} <span v-if="sortKey === 'courseStatus'">{{ sortOrder === 'asc' ? '▲' : '▼' }}</span></th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="employee in sortedEmployees" :key="employee.empcardid">
                                    <td>{{ employee.empcardid }}</td>
                                    <td>{{ employee.name }}</td>
                                    <td>{{ employee.jobtitle }}</td>
                                    <td>{{ employee.departmentname }}</td>
                                    <td>
                                        <span v-if="filterCourse">{{ hasCompletedCourse(employee, filterCourse, filterRound) ? '✅' : '❌' }}</span>
                                        <span v-else>N/A</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            Copyright 2025 &copy; Docflow
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3.2.31/dist/vue.global.prod.js"></script>
    <script>
        const { createApp } = Vue

        createApp({
            data() {
                return {
                    allEmployees: [],
                    filteredEmployeesList: [], // This will be the filtered list
                    departments: [],
                    coursegroups: [],
                    coursemain: [],
                    availableCourses: [],
                    filterCourse: '',
                    filterRound: '',
                    trainingRounds: [],
                    filterEmployeeId: '',
                    sortKey: '',
                    sortOrder: 'asc'
                }
            },
            computed: {
                sortedEmployees() {
                    if (!this.sortKey) {
                        return this.filteredEmployeesList;
                    }
                    return [...this.filteredEmployeesList].sort((a, b) => {
                        let aValue;
                        let bValue;

                        if (this.sortKey === 'courseStatus') {
                            aValue = this.hasCompletedCourse(a, this.filterCourse, this.filterRound);
                            bValue = this.hasCompletedCourse(b, this.filterCourse, this.filterRound);
                        } else {
                            aValue = a[this.sortKey];
                            bValue = b[this.sortKey];
                        }
                        
                        if (aValue < bValue) {
                            return this.sortOrder === 'asc' ? -1 : 1;
                        }
                        if (aValue > bValue) {
                            return this.sortOrder === 'asc' ? 1 : -1;
                        }
                        return 0;
                    });
                }
            },
            methods: {
                sortBy(key) {
                    if (this.sortKey === key) {
                        this.sortOrder = this.sortOrder === 'asc' ? 'desc' : 'asc';
                    } else {
                        this.sortKey = key;
                        this.sortOrder = 'asc';
                    }
                },
                applyFilters() {
                    // Logic moved from watch property
                    if (this.filterCourse) {
                        const rounds = new Set();
                        this.allEmployees.forEach(employee => {
                            employee.courses.forEach(course => {
                                if (course.name === this.filterCourse) {
                                    rounds.add(course.startDate);
                                }
                            });
                        });
                        this.trainingRounds = Array.from(rounds).sort();
                    } else {
                        this.trainingRounds = [];
                    }
                    this.filterRound = '';

                    if (!this.filterCourse) {
                        this.filteredEmployeesList = [];
                        return;
                    }

                    let filtered = this.allEmployees;

                    if (this.filterEmployeeId) {
                        filtered = filtered.filter(employee => 
                            employee.empcardid.toLowerCase().includes(this.filterEmployeeId.toLowerCase())
                        );
                    }

                    this.filteredEmployeesList = filtered;
                },
                resetFilters() {
                    this.filterCourse = '';
                    this.filterRound = '';
                    this.filterEmployeeId = '';
                    this.filteredEmployeesList = []; // Clear the list when filters are reset
                },
                hasCompletedCourse(employee, courseName, round) {
                    if (round) {
                        return employee.courses.some(c => c.name === courseName && c.startDate === round && c.completed);
                    }
                    return employee.courses.some(c => c.name === courseName && c.completed);
                }
            },
            mounted() {
                fetch('data.json')
                    .then(response => response.json())
                    .then(data => {
                        this.allEmployees = data.employees;
                        this.filteredEmployeesList = []; // Initialize with an empty array
                        this.departments = data.departments;
                        this.coursegroups = data.coursegroups;
                        this.coursemain = data.coursemain;
                        this.availableCourses = data.availableCourses;
                    });
            }
        }).mount('#app')
    </script>
</body>
</html>